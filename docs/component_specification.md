# Component Specification

## Software Components
1. Data ingestion manager (`preprocess.py`)  
  - Loads `.mat` EEG datasets  
  - Validates file structure  
  - Prepares data for downstream analysis  

      Required input:  
        - File paths to EEG recordings  
        - Configuration parameters from `pyproject.toml`  
      
      Output provided:  
        - Structured data object (i.e., Python dictionary) containing raw EEG signals  
        - Metadata summary (e.g., Stimulus frequencies, amplitude, trial number)  

2. EEG data filtering and ICA Denoising manager (`filters.py`,`reconstruct.py`)  
  - Performs artifact rejection  
  - Performs bandpass filtering of EEG signals  
  - Performs ICA based denoising method  

      Required input:  
        - Preprocessed EEG data object  
        - Filter parameters (low/high cutoff frequencies, order)  
        - ICA parameters (number of components, algorithm choice)  
        - Noise-component identification rules for ICA-based denoising  
    
      Outputs provided:   
        - Filtered and cleaned EEG dataset  
        - ICA decomposition object (unmixing matrix, time-series components)  
    
3. Statistical Analysis Manager (`statistics.py`)  
  - Performs bootstrap-based confidence interval tests on cleaned and filtered EEG dataset  

      Required input:  
        - Denoised EEG data  
        - Stimulus metadata (frequencies, amplitude, trial number)  
        - Analysis parameters (e.g., FFT window lengths, bootstrap iteration number, etc.)  
    
      Outputs provided:  
        - Results from confidence interval tests which determine if the fish heard a given sound frequency
        
4. Visualization Manager (`plotting.py`)  
  - Plots results of statistical analysis and displays the auditory sensitivity of the fish for multiple sound frequencies  

      Required input:  
        - Outputs from statistical analysis manager  
        - Metadata (fish ID, stimulus conditions)  
        - User-selected visualization options (e.g., x and y axes limits, shared axes ON/OFF, etc.)  
    
      Outputs provided:  
      - Interactive data visualizations (e.g., with tooltips) showing auditory sensitivity of fish across tested sound frequencies  

5. Website (`index.html`)  
  - There is not technically a manager or python script for taking the outputs of the visualization manager and applying it to the website. The user has to code in HTML themselves to display their data analysis results themselves.  

## Interactions to accomplish "Use Cases"
### Use Case 1: Analyze EEG Data
1. User loads dataset through Data ingestion manager. 
2. The EEG data filtering and ICA denoising manager applies bandpass filtering, ICA-based denoising to output cleaned EEG signals
3. The statisitcal analysis manager receives the denoised data and runs statistical tests to determine the auditory sensitivity of the fish
4. The visualization manager recieves the analysis ouputs and produces plots that show the auditory responses and exports data that can be used for the interactive web-visualization
5. The results of this analysis are then available to be shared and viewed with PI/collaborators

### Use Case 2: Exploring the results of data analysis
1. The outputs from the Visualization Manager are integrated into the html code by the main experimenter
2. The user opens the following website link (https://aoih-uw.github.io/fish_eeg/index.html) to see the results generated by the analysis pipeline
3. The user clicks through the "Start Guided Tour" button on the homepage to get a quick sense of the contents of this website
4. The user will click through the pages of the website that are listed on the top of the screen
5. The user will scroll, pan over, and click on interactive elements on the screen like the plots of the results, audio file players, file download buttons, etc.
6. The user will (ideally) understand the results through these interactive visualizations and thorough explanations provided on the site

## Preliminary plan
1. Aoi will design and code the components of the data analysis needed to analyze this dataset
2. Yash, Mike, Jeff will
    - Refactor Aoi's initial code set  
    - Write docstrings  
    - Write  `pyproject.toml` and `__init__.py` files  
    - Create example of using the package  
4. All members will write tests for this code set
5. Chris will take the outputs from the refactored code and display the results onto an interactive web visualization
6. All members of the team will review eachothers work for possible errors and inconsistencies across package
